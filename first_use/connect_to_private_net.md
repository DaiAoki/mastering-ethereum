## プライベート・ネットに接続する

Gethのインストールが完了したら早速Gethを起動します。

2015/7/30にEthereumの最初のβ版であるFrontierがリリースされてから、Ethereumの本番ネットワーク（ライブ・ネット）の稼働が開始されました。

ライブ・ネットは不特定多数のノードが参加するP2Pネットワークです。一方で自分または自分の知るノードのみが参加するEthereumネットワークを構築することも可能であり、これをプライベート・ネットと呼びます。限られた参加者のみのネットワークなので、容易にEtherが採掘が可能ですし[^1]、安全性も高いネットワークになります。そのため、Ethereumの動作を調べたり、分散型アプリケーション（Dapp）の開発作業など個人的な作業を行うには、プライベート・ネットを立ち上げてそこでいろいろ弄ってみると便利です。

そこで本節では、インストールしたGethを起動し、プライベート・ネットに接続するところまでを解説していきます。

### Genesisファイルを作成する

Genesisファイルとは、ネットワークでやり取りされるブロックチェーンの最初（Block番号 "0"）のブロックである「Genesisブロック」の情報を記述したファイルです。プライベート・ネットでは独自のブロックチェーンをやり取りしていくため、独自のGenesisブロックを定義したGenesisファイルを用意して利用します[^2]。

まず任意の場所にプライベート・ネット用の各種データを格納するディレクトリを作成します[^2]。ここでは、ログイン・ユーザー（今回の例ではtest_u）のhomeディレクトリ直下に作成します。

``` plain
$ mkdir /home/test_u/eth_private_net
```

次に上記ディレクトリ内にjson形式の下記の内容[^3] を記述した`myGenesis.json`ファイルを配置します。

```javascript
{
  "nonce": "0x0000000000000042",
  "timestamp": "0x0",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "extraData": "0x0",
  "gasLimit": "0x8000000",
  "difficulty": "0x4000",
  "mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "coinbase": "0x3333333333333333333333333333333333333333",
  "alloc": {}
}
```

### Gethをプライベート・ネットで起動する

データ用ディレクトリを作成したら、以下のコマンドでGethを起動します。
```plain
$ geth --networkid "10" --nodiscover --datadir "/home/test_u/eth_private_net" --genesis "/home/test_u/eth_private_net/myGenesis.json" console 2>> /home/test_u/eth_private_net/geth_err.log
```
ここで各オプションの意味は以下のとおりです。
* `--networkid "10"` ：本オプションで任意の正の整数のIDを指定することで、ライブ・ネットとは異なるネットワークを立ち上げることが可能です（ここでは10を指定）。
* `--nodiscover` ：Gethはデフォルトで自動的に（同じネットワークID）のEthereumネットワークのノード（Peer）を探し接続を試みます。プライベート・ネットでは未知のノードとの接続を避けるため、このオプションで自動Peer探索機能を無効にします。
* `--datadir "/home/test_u/eth_private_net"`：データ用ディレクトリとして、事前に作成しておいたディレクトリのパスを指定しています。データ用ディレクトリにはブロックチェーン情報やノード情報など各種データが保存されます。
* `console`：Gethには採掘やトランザクションの生成などを対話的に進めることができるコンソールが用意されています。`console`サブ・コマンドを指定することで、Gethの起動時に同時にコンソール立ち上げることが可能です。なお、`console`サブ・コマンドを付加せずに、Gethのプロセスをバックグラウンドで起動させておき、後からそのプロセスのコンソールを起動する事も可能です（下記TIP参照）。

上記コマンドを実行すると、下記の実行結果のように、幾つかの情報の表示の後に「>」のプロンプトが表示され、コンソールが起動されます。今後、特にことわりのない限り、このように起動したGethプロンプト上で作業していく前提で進めていきます。

```
instance: Geth/v1.3.5/linux/go1.5.1
 datadir: /home/test_u/eth_private_net
coinbase: null
at block: 0 (Thu, 01 Jan 1970 09:00:00 JST)
modules: admin:1.0 db:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 shh:1.0 txpool:1.0 web3:1.0
>

```
<!--[TODO]実際にテストネットでは自分ひとりということをpeercountコマンドで確認する手順を入れても良いかも。-->

###### ■■ TIP ■■
今後Gethを使用していくなかで、採掘等のためにGethをバックグラウンドで常時起動しておき、必要に応じてそのGethプロセスに対してコンソールを用いて対話的に操作をしたいといった場合が発生します。その際は、下記のように`attach`サブ・コマンドを利用することで、既に起動されたGethプロセスのコンソールを起動することが可能です。

```
$ # gethプロセスをconsoleサブ・コマンドを付加せず、かつ最後に"&"を付加することで、バックグラウンドで起動します。
$ # この場合、起動時にはコンソールは立ち上がりません。
$ geth --networkid "10" --nodiscover --datadir "/home/test_u/eth_private_net" --genesis "/home/test_u/eth_private_net/myGenesis.json" 2>> /home/test_u/eth_private_net/geth_err.log &
$
$ # attachサブ・コマンドを用いて先に立ち上げたプロセスのコンソールを立ち上げます。
$ # ここで、ipc:以降に先に立ち上げたgethプロセスのデータ用ディレクトリ以下のgeth.ipcファイル（実際はソケット）のパスを指定します。
$ geth --datadir "/home/test_u/eth_private_net" attach ipc:/home/test_u/eth_data/geth.ipc

instance: Geth/v1.3.5/linux/go1.5.1
（実行結果 中略）
modules: admin:1.0 db:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 shh:1.0 txpool:1.0 web3:1.0
> 


```

###脚注
[^1] ただし、テスト・ネットで採掘したEtherはテスト・ネット内のみで有効で、ライブ・ネットでは使用できないことに注意してください。

[^2] 独自のgenesisファイルを使用することの最大の目的は「採掘を容易にする」ことです。プライベート・ネットでもデフォルトのgenesisブロックを使うことも可能ですが、デフォルトのgenesisブロック（＝[Frontierのgenesisブロック](http://etherscan.io/block/0)）の採掘難易度（Difficulty）が非常に高く（17,179,869,184）設定されたため、プライベート・ネットでの採掘が非常に困難になりました。そのためDifficultyの小さい独自のGenesisファイルを用意してプライベート・ネット内での採掘を容易にすることが慣習になっています。

[^3]内容は独自にカスタマイズしても構いませんが、詳しくない場合はそのままコピーした内容で構いません。

[^2] Gethのデフォルトではホーム・ディレクトリ以下に「.ethereum」という名前の隠しディレクトリが作成され、それがデータ・ディレクトリになります。ただし、今後プライベート・ネットとライブ・ネットとでデータディレクトリを分ける方が管理がしやすいことを考えると、データディレクトリをプライベート・ネット用に明示的に指定したほうがよいでしょう。

