## トランザクションの構築

Aliceのウォレット・アプリケーションは、Aliceが行おうとするトランザクションに必要なインプットを自動的に集めアウトプットを構成するためのロジックが組み込まれています。そのためAliceは送金先とその送金額だけ指定すればよく、その他に必要な処理はアプリケーションの中で自動的に行ってくれます。重要なこととして、トランザクションはアプリケーションがネットワークに繋がっていない時にも構成可能ということが挙げられます。家にいる時に小切手に必要事項を書いて封書で銀行に郵送できるように、ビットコインのトランザクションの構築と送金の承認はネットワークに繋がっていない状態でも可能であり、その後ネットワークに接続された際に送金を実行することが可能です。

### 適切なインプットを集める
Aliceのウォレット・アプリケーションは、まず最初にBobに支払う額に足るインプットを探さなければなりません。ほとんどのウォレット・アプリケーションは、そのウォレット自身の秘密鍵によってロック（解除制限）されている未使用のトランザクション・アウトプット（UTXO:Unspent Transaction Output）を管理するための小さなデータベースを持っています。そのためAliceのウォレットにはJoeから現金と引き換えにビットコインを受け取った（＜最初のビットコインを手に入れる＞節参照）トランザクション・アウトプットの情報が保持されています。. ウォレット・アプリケーションの中にはネットワーク上の全ての未使用のトランザクション・アウトプットを保持するものもあり、受信した任意のトランザクションが正当なインプットを元に構成されているのかを素早く検証することもできます。しかしこのようなクライアントは非常に大きなデータ容量を使用するため、一般的なユーザーは自身の未使用トランザクション・アウトプットのみを管理する「軽量クライアント」を使います。

ウォレットがUTXOを管理していない場合でも、様々なAPIを通じてプロバイダに問い合わせたり、bitcoin JSON RPC APIを用いてフル・インデックス・ノードに問い合わせることで情報を得ることができます。例2-1では、特定のURLへの HTTP GET コマンドとして RESTfulなAPIへのリクエストを送る例を示しています。このURLは、あるアドレスの未使用トランザクション・アウトプットを返すものです。ここではレスポンスを受け取るために、コマンド _cURL_を使います。

例2-1： Aliceのビットコイン・アドレスが持つUTXOの検索
```
$ curl https://blockchain.info/unspent?active=1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK
```

例2-2： 検索に対するレスポンス
```
{
    "unspent_outputs":[
        {
            "tx_hash":"186f9f998a5...2836dd734d2804fe65fa35779",
            "tx_index":104810202,
            "tx_output_n": 0,
            "script":"76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac",
            "value": 10000000,
            "value_hex": "00989680",
            "confirmations":0
        }
    ]
}
```

例2-2のレスポンス結果には、Aliceのアドレス（`1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK`）がオーナーの１つのUTXOがあります。またそのアウトプットが生まれたJoeからの支払いに関するトランザクションの情報も含まれ、支払額の 0.10 bitcoin が satoshiの単位で記載されています（1,000万 satoshi）。この情報をもとにAliceのウォレット・アプリケーションは新しいオーナーへビットコインを送金するためのトランザクションを構築することになります。