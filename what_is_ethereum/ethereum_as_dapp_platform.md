## Ethereumとは

###分散アプリケーション開発の障壁

前節で、ブロックチェーン技術の革新性と、通貨（ビットコイン）だけに収まらない応用の可能性について述べてきました。

ブロックチェーン技術を用いた新たな応用サービスをローンチするためには、２つの選択肢があります。１つは新たなサービスのために新しいブロックチェーンを構築しそれを使ってサービスを行うこと。２つめは既存のビットコインのブロックチェーンを利用しその上にサービスを構築するというものです。前節に挙げた応用例での、[Storj](http://storj.io/)や、[Namecoin](https://namecoin.info/)は前者のタイプであり、[Proof of Existence](http://www.proofofexistence.com/)は、後者のタイプになります。

新しいブロックチェーンを構築することは、非常に敷居の高い方法です。実装に相当の工数がかかり、またさらに重要なのは、ブロックチェーンの特性上、サービスのローンチ当初から「合意」の形成が安定して動作するためには、相当数の参加者が事前に集まっている必要があるからです。これは需要の少ないニッチなサービスを展開する際には、非常に致命的な問題になります。

一方で、既存のビットコインのブロックチェーンを利用したサービス提供する場合は、あくまでビットコイン自体の設計上の制限に従う必要があり、非常に不自由なものとなってしまします。

###Ethereumとは
Ethereumは「分散アプリケーションプラットフォーム」です。分散アプリケーションが動作する基盤を用意することで、上述のような、分散アプリケーションを開発する際の障壁を取り除くことを目的としています。

Ethereumは任意の処理が記述可能（チューリング完全）な、組み込みのプログラミング言語を備えます。分散アプリケーションの開発者は、この組み込みの言語を用いてプログラミングを行い開発を行います。分散アプリケーションのコードは、ブロックチェーンに組み込まれビットコインと同様にプルーフ・オブ・ワークの仕組みにより、改ざん不可能になります。このコードはEthereumネットワークに参加する各（採掘者の）ノード上で実行され、その結果の状態もブロックチェーンに組み込まれ、やはり改ざんが不可能になります。

Ethereumのプラットフォーム上で動作するよう開発された様々な分散アプリケーションは、Ethereumのブロックチェーンを共有して利用します。そのため、利用者が少ないニッチな分散アプリケーションでも分散システム上での「合意形成」が安定して動作することが可能です。

ここで、少しEthereumの仕組みの概略を見ていきましょう。

#### ether
Ethereumでは、「ether」という独自の内部通貨が規定されています。ビットコインと同様、それ自体が価値を持つ通貨としての利用も可能ですが、より重要な事はetherがEthereum内で分散アプリケーションやスマート・コントラクトを実行するための「燃料」の役割を果たすという事です。Ethereumは上述のように、その上で動作する分散アプリケーションに対して、任意の処理を可能にしており、それぞれの分散アプリケーション間でその動作に必要な計算資源の量は異なってきます。そこで、Ethereumでは、分散アプリケーションを実行するためには、その処理の重さに応じた燃料が必要」とすることにより、Ethereum上で動作する分散アプリケーション間での計算資源の割り当ての平等性を確保しています。

etherは、単位名が通貨名と同じでetherですが、米国の通貨で、1 doller ＝ 100 cent と規定されているように、etherも利便性のためより少額のetherに対して下記のように単位名が決められています。

* 1 ether ＝ 10[^3] finney
* 1 ether ＝ 10[^6] szabo
* 1 ether ＝ 10[^18] wei


#### アカウント
<!-- 話しを簡略にするため、CA⇒CAのメッセージについては敢えて言及しない方針 -->

Ethereumには、「アカウント」と呼ばれるオブジェクトが既定されています。アカウントは16進数で表わされるアドレス（例えば、0x4c84913cc41f2aad9c24d82bfde598c91cdd33d3）[^1] により参照され、アカウント間で交わされるトランザクションによりアカウントの状態が変化していきます。

「アカウント」には２つのタイプが存在します。一つは「Externally Owned Account（EOA）」、もう一つは「Contract Account（CA）」です。アカウントは、主に次の４つのフィールドを持ち、そのフィールドの値が、つまりはそのアカウントの「状態」になります。

* nonce：そのアカウントが送信した累積トランザクション数
* ether balance：そのアカウントが所有するether量
* contract code：コントラクトのコード（EOAの場合は空）
* storage：そのアカウントが保持するデータ

EOAは、我々ユーザーにより生成されコントロールされるアカウントです。ユーザーの任意のタイミングでトランザクションを生成し、他EOAへのetherの送金、新しいCAの生成、CAのコードの実行を行います。

一方で、CAは、EOAからトランザクションを介して生成されます。CAは一種の自動エージェントであり、EOAが発信するトランザクションをトリガに、contract code フィールドに格納されたコード（コントラクト）を実行します。

[^1] ここで先頭の「0x」は16進数を表わすプレフィックスです。

#### トランザクション
<!-- トランザクションを介して状態が変わること --＞
<!-- トランザクションは４つのフィールドを持っていること。 --＞
<!-- データフィールどの簡単な説明 -->
<!-- StartGasとGasPriceの簡単な説明 -->

Ethereumでは各アカウントの状態は「トランザクション」により遷移していきます [^1]。EOAからEOAがトランザクションを生成しそれをEthereumネットワーク上に送信します。採掘者は受信したトランザクションの正当性をチェックし、問題なければトランザクションとトランザクションの内容に基づいて変化した最新のアカウントの状態をブロックチェーンに埋め込みます。

Ethereumネットワーク上ではトランザクションは送信者の署名を含んだデータのパッケージであり、主に以下の内容を含みます。
* トランザクションの相手のアドレス
* トランザクション送信者の署名
* etherの送金額
* 任意のデータ
* STARTGAS値
* GASPRICE値

最初の３つは一般的な暗号通貨のトランザクションと同じです。Ethereumの内部通貨である、etherの送金する際の相手のアドレスと送金額、そして送金するためのトランザクションの生成者が正当なetherの持ち主であることを証明する署名です。

「任意のデータ」はCAが持つコードを実行するための入力値が格納されます。例えばIPアドレスとドメイン名の紐づけを管理する分散アプリケーションを考えた場合、そのアプリケーションに対して、登録したいIPアドレスとドメイン名の情報をアプリケーション（正確にはアプリケーションのコードを持つCA）に引き渡す必要があります。この引き渡すデータを「任意のデータ」フィールドに格納し、CAはそのデータを基に、IPと
ドメイン名の紐づけ情報を自身の`storage`フィールドに格納します。


##### トランザクションの流れ
<!-- トランザクションがどのようにアカウントの状態を変更していくのかを見ていこう。 -->
<!-- 具体的な例を示してみていく。 -->

[^1] 実際には、状態の遷移はトランザクションだけでなく、「メッセージ」によっても遷移が行われますがここでは説明を省きます。「トランザクション」はEOAにより生成/送信されるのに対して「メッセージ」はCAにより生成/送信されます。

#### ブロックチェーンと採掘
ビットコインのシステムで、ブロックチェーンはビットコイン・ネットワーク上で発生したすべてのトランザクションを記録した、誰でも参照可能な公開取引元帳の役割を果たしていました。

Ethereumのブロックチェーンも同様に公開元帳の役割を果たします。ただビットコインの場合とは異なり、Ethereumのアカウントのブロックチェーンには、トランザクションだけでなくEthereumネットワークの全アカウントの最新の状態に関する情報も記録されます。

つまり、ブロックチェーンにはトランザクションとアカウントの状態が記録されていき、そのブロックチェーンに書き込まれた状態を「正」とするEtherumネットワーク内の合意が形成されていきます。

Ethereumネットワーク内の採掘者は、etherの報酬を目当てに、ブロックの採掘競争を続けます。Ethereumでは、新しいブロックが平均して12秒に1回採掘されるように動的にプルーフ・オブ・ワークの難易度を調整されるように設計されています。

Ethereum では、採掘が成功すると、
* 1採掘当たり固定で5 ether
* ブロックに含まれる全てのcontractのコードを実行した際に消費したgasに相当するether
* ブロックに含んだ1つのUncleブロック当たり1/32 ether

の報酬が採掘者に与えられます。
